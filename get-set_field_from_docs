/*
 * File: batch_merge
 * Author: Moses Kinyua (Oduktech)
 * Created: 19/08/2025
 * Last Modified: 19/08/2025
 * Description: adds customer name to work order from associated sales order.
 *
 * Copyright Â©2025 Oduktech. All rights reserved.
 */

frappe.ui.form.on('Work Order', {
    //when sales_order field is changed
    sales_order: function(frm) {
        if (frm.doc.sales_order) {
            get_customer_from_so(frm);
        }
    },

    //when form is loaded
    onload: function(frm) {
        if (frm.doc.sales_order) {
            get_customer_from_so(frm);
        }
    }
});

// Helper function to avoid code duplication
var get_customer_from_so = function(frm) {
    frappe.call({
        method: "frappe.client.get_value",
        args: {
            doctype: "Sales Order",
            fieldname: "customer_name",
            filters: {
                "name": frm.doc.sales_order
            }
        },
        callback: function(r) {
            if (r.message && r.message.customer_name) {
                frm.set_value("customer_name", r.message.customer_name);
            }
        }
    });
};
